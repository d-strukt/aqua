{"version":3,"file":"hyperapp-render.min.js","sources":["src/index.js"],"sourcesContent":["const { isArray } = Array\nconst { hasOwnProperty } = Object.prototype\nconst styleNameCache = new Map()\nconst uppercasePattern = /[A-Z]/g\nconst msPattern = /^ms-/\n\n// https://www.w3.org/International/questions/qa-escapes#use\nconst escapeRegExp = /[\"&'<>]/\n\n// https://www.w3.org/TR/html/syntax.html#void-elements\nconst voidElements = new Set([\n  'area',\n  'base',\n  'br',\n  'col',\n  'embed',\n  'hr',\n  'img',\n  'input',\n  'link',\n  'meta',\n  'param',\n  'source',\n  'track',\n  'wbr',\n])\n\n// credits to https://github.com/component/escape-html\nexport function escapeHtml(value) {\n  const str = '' + value\n  if (typeof value === 'number') {\n    // better performance for safe values\n    return str\n  }\n\n  const match = escapeRegExp.exec(str)\n  if (!match) {\n    return str\n  }\n\n  let { index } = match\n  let lastIndex = 0\n  let out = ''\n\n  for (let escape = ''; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n      case 34: // \"\n        escape = '&quot;'\n        break\n      case 38: // &\n        escape = '&amp;'\n        break\n      case 39: // '\n        escape = '&#39;' // shorter than \"&apos;\" and \"&#x27;\" plus supports HTML4\n        break\n      case 60: // <\n        escape = '&lt;'\n        break\n      case 62: // >\n        escape = '&gt;'\n        break\n      default:\n        continue\n    }\n\n    if (lastIndex !== index) {\n      out += str.substring(lastIndex, index)\n    }\n\n    lastIndex = index + 1\n    out += escape\n  }\n\n  return lastIndex !== index ? out + str.substring(lastIndex, index) : out\n}\n\n// credits to https://github.com/jorgebucaran/classcat\nexport function concatClassNames(value) {\n  if (typeof value === 'string' || typeof value === 'number') {\n    return value || ''\n  }\n\n  let out = ''\n  let delimiter = ''\n\n  if (isArray(value)) {\n    for (let i = 0; i < value.length; i++) {\n      const name = concatClassNames(value[i])\n      if (name !== '') {\n        out += delimiter + name\n        delimiter = ' '\n      }\n    }\n  } else {\n    for (const name in value) {\n      if (hasOwnProperty.call(value, name) && value[name]) {\n        out += delimiter + name\n        delimiter = ' '\n      }\n    }\n  }\n\n  return out\n}\n\n// \"backgroundColor\" => \"background-color\"\n// \"MozTransition\" => \"-moz-transition\"\n// \"msTransition\" => \"-ms-transition\"\nfunction hyphenateStyleName(styleName) {\n  return (\n    styleNameCache.get(styleName) ||\n    styleNameCache\n      .set(\n        styleName,\n        styleName\n          .replace(uppercasePattern, '-$&')\n          .toLowerCase()\n          .replace(msPattern, '-ms-'),\n      )\n      .get(styleName)\n  )\n}\n\nexport function stringifyStyles(style) {\n  let out = ''\n  let delimiter = ''\n\n  for (const name in style) {\n    if (hasOwnProperty.call(style, name)) {\n      const value = style[name]\n\n      if (value != null) {\n        if (name === 'cssText') {\n          out += delimiter + value\n        } else {\n          out += delimiter + hyphenateStyleName(name) + ':' + value\n        }\n        delimiter = ';'\n      }\n    }\n  }\n\n  return out\n}\n\n// https://www.w3.org/TR/html51/syntax.html#serializing-html-fragments\nfunction renderFragment(name, props, children, stack) {\n  let out = ''\n  let footer = ''\n\n  if (name) {\n    out += '<' + name\n\n    for (let prop in props) {\n      if (hasOwnProperty.call(props, prop)) {\n        let value = props[prop]\n\n        if (\n          value != null &&\n          prop !== 'key' &&\n          prop !== 'innerHTML' &&\n          prop !== '__source' && // babel-plugin-transform-react-jsx-source\n          !(prop[0] === 'o' && prop[1] === 'n')\n        ) {\n          if (prop === 'class' || prop === 'className') {\n            prop = 'class'\n            value = concatClassNames(value) || false\n          } else if (prop === 'style' && value && typeof value === 'object') {\n            value = stringifyStyles(value) || false\n          }\n\n          if (value !== false) {\n            out += ' ' + prop\n\n            if (value !== true) {\n              out += '=\"' + escapeHtml(value) + '\"'\n            }\n          }\n        }\n      }\n    }\n\n    if (voidElements.has(name)) {\n      out += '/>'\n    } else {\n      out += '>'\n      footer = '</' + name + '>'\n    }\n  }\n\n  const { innerHTML } = props\n\n  if (innerHTML != null) {\n    out += innerHTML\n  }\n\n  if (children.length > 0) {\n    stack.push({\n      childIndex: 0,\n      children,\n      footer,\n    })\n  } else {\n    out += footer\n  }\n\n  return out\n}\n\nfunction resolveNode(node, state, actions) {\n  if (typeof node === 'function') {\n    return resolveNode(node(state, actions), state, actions)\n  }\n\n  return node\n}\n\nexport function renderer(view, state, actions) {\n  const stack = [\n    {\n      childIndex: 0,\n      children: [view],\n      footer: '',\n    },\n  ]\n  let end = false\n\n  return (bytes) => {\n    if (end) {\n      return null\n    }\n\n    let out = ''\n\n    while (out.length < bytes) {\n      if (stack.length === 0) {\n        end = true\n        break\n      }\n\n      const frame = stack[stack.length - 1]\n\n      if (frame.childIndex >= frame.children.length) {\n        out += frame.footer\n        stack.pop()\n      } else {\n        const node = resolveNode(frame.children[frame.childIndex++], state, actions)\n\n        if (node != null && typeof node !== 'boolean') {\n          if (isArray(node)) {\n            stack.push({\n              childIndex: 0,\n              children: node,\n              footer: '',\n            })\n          } else if (node.type === 3) {\n            out += escapeHtml(node.name)\n          } else if (typeof node === 'object') {\n            out += renderFragment(\n              node.name || node.nodeName,\n              node.props || node.attributes,\n              node.children,\n              stack,\n            )\n          } else {\n            out += escapeHtml(node)\n          }\n        }\n      }\n    }\n\n    return out\n  }\n}\n\nexport function renderToString(view, state, actions) {\n  return renderer(view, state, actions)(Infinity)\n}\n"],"names":["isArray","Array","hasOwnProperty","Object","prototype","styleNameCache","Map","uppercasePattern","msPattern","escapeRegExp","voidElements","Set","escapeHtml","value","str","match","exec","index","lastIndex","out","escape","length","charCodeAt","substring","concatClassNames","delimiter","i","name","call","stringifyStyles","style","styleName","get","set","replace","toLowerCase","renderFragment","props","children","stack","footer","prop","has","innerHTML","push","childIndex","resolveNode","node","state","actions","view","end","bytes","frame","pop","type","nodeName","attributes","renderer","Infinity"],"mappings":"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"}