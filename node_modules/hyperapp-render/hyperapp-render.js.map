{"version":3,"file":"hyperapp-render.js","sources":["src/index.js"],"sourcesContent":["const { isArray } = Array\nconst { hasOwnProperty } = Object.prototype\nconst styleNameCache = new Map()\nconst uppercasePattern = /[A-Z]/g\nconst msPattern = /^ms-/\n\n// https://www.w3.org/International/questions/qa-escapes#use\nconst escapeRegExp = /[\"&'<>]/\n\n// https://www.w3.org/TR/html/syntax.html#void-elements\nconst voidElements = new Set([\n  'area',\n  'base',\n  'br',\n  'col',\n  'embed',\n  'hr',\n  'img',\n  'input',\n  'link',\n  'meta',\n  'param',\n  'source',\n  'track',\n  'wbr',\n])\n\n// credits to https://github.com/component/escape-html\nexport function escapeHtml(value) {\n  const str = '' + value\n  if (typeof value === 'number') {\n    // better performance for safe values\n    return str\n  }\n\n  const match = escapeRegExp.exec(str)\n  if (!match) {\n    return str\n  }\n\n  let { index } = match\n  let lastIndex = 0\n  let out = ''\n\n  for (let escape = ''; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n      case 34: // \"\n        escape = '&quot;'\n        break\n      case 38: // &\n        escape = '&amp;'\n        break\n      case 39: // '\n        escape = '&#39;' // shorter than \"&apos;\" and \"&#x27;\" plus supports HTML4\n        break\n      case 60: // <\n        escape = '&lt;'\n        break\n      case 62: // >\n        escape = '&gt;'\n        break\n      default:\n        continue\n    }\n\n    if (lastIndex !== index) {\n      out += str.substring(lastIndex, index)\n    }\n\n    lastIndex = index + 1\n    out += escape\n  }\n\n  return lastIndex !== index ? out + str.substring(lastIndex, index) : out\n}\n\n// credits to https://github.com/jorgebucaran/classcat\nexport function concatClassNames(value) {\n  if (typeof value === 'string' || typeof value === 'number') {\n    return value || ''\n  }\n\n  let out = ''\n  let delimiter = ''\n\n  if (isArray(value)) {\n    for (let i = 0; i < value.length; i++) {\n      const name = concatClassNames(value[i])\n      if (name !== '') {\n        out += delimiter + name\n        delimiter = ' '\n      }\n    }\n  } else {\n    for (const name in value) {\n      if (hasOwnProperty.call(value, name) && value[name]) {\n        out += delimiter + name\n        delimiter = ' '\n      }\n    }\n  }\n\n  return out\n}\n\n// \"backgroundColor\" => \"background-color\"\n// \"MozTransition\" => \"-moz-transition\"\n// \"msTransition\" => \"-ms-transition\"\nfunction hyphenateStyleName(styleName) {\n  return (\n    styleNameCache.get(styleName) ||\n    styleNameCache\n      .set(\n        styleName,\n        styleName\n          .replace(uppercasePattern, '-$&')\n          .toLowerCase()\n          .replace(msPattern, '-ms-'),\n      )\n      .get(styleName)\n  )\n}\n\nexport function stringifyStyles(style) {\n  let out = ''\n  let delimiter = ''\n\n  for (const name in style) {\n    if (hasOwnProperty.call(style, name)) {\n      const value = style[name]\n\n      if (value != null) {\n        if (name === 'cssText') {\n          out += delimiter + value\n        } else {\n          out += delimiter + hyphenateStyleName(name) + ':' + value\n        }\n        delimiter = ';'\n      }\n    }\n  }\n\n  return out\n}\n\n// https://www.w3.org/TR/html51/syntax.html#serializing-html-fragments\nfunction renderFragment(name, props, children, stack) {\n  let out = ''\n  let footer = ''\n\n  if (name) {\n    out += '<' + name\n\n    for (let prop in props) {\n      if (hasOwnProperty.call(props, prop)) {\n        let value = props[prop]\n\n        if (\n          value != null &&\n          prop !== 'key' &&\n          prop !== 'innerHTML' &&\n          prop !== '__source' && // babel-plugin-transform-react-jsx-source\n          !(prop[0] === 'o' && prop[1] === 'n')\n        ) {\n          if (prop === 'class' || prop === 'className') {\n            prop = 'class'\n            value = concatClassNames(value) || false\n          } else if (prop === 'style' && value && typeof value === 'object') {\n            value = stringifyStyles(value) || false\n          }\n\n          if (value !== false) {\n            out += ' ' + prop\n\n            if (value !== true) {\n              out += '=\"' + escapeHtml(value) + '\"'\n            }\n          }\n        }\n      }\n    }\n\n    if (voidElements.has(name)) {\n      out += '/>'\n    } else {\n      out += '>'\n      footer = '</' + name + '>'\n    }\n  }\n\n  const { innerHTML } = props\n\n  if (innerHTML != null) {\n    out += innerHTML\n  }\n\n  if (children.length > 0) {\n    stack.push({\n      childIndex: 0,\n      children,\n      footer,\n    })\n  } else {\n    out += footer\n  }\n\n  return out\n}\n\nfunction resolveNode(node, state, actions) {\n  if (typeof node === 'function') {\n    return resolveNode(node(state, actions), state, actions)\n  }\n\n  return node\n}\n\nexport function renderer(view, state, actions) {\n  const stack = [\n    {\n      childIndex: 0,\n      children: [view],\n      footer: '',\n    },\n  ]\n  let end = false\n\n  return (bytes) => {\n    if (end) {\n      return null\n    }\n\n    let out = ''\n\n    while (out.length < bytes) {\n      if (stack.length === 0) {\n        end = true\n        break\n      }\n\n      const frame = stack[stack.length - 1]\n\n      if (frame.childIndex >= frame.children.length) {\n        out += frame.footer\n        stack.pop()\n      } else {\n        const node = resolveNode(frame.children[frame.childIndex++], state, actions)\n\n        if (node != null && typeof node !== 'boolean') {\n          if (isArray(node)) {\n            stack.push({\n              childIndex: 0,\n              children: node,\n              footer: '',\n            })\n          } else if (node.type === 3) {\n            out += escapeHtml(node.name)\n          } else if (typeof node === 'object') {\n            out += renderFragment(\n              node.name || node.nodeName,\n              node.props || node.attributes,\n              node.children,\n              stack,\n            )\n          } else {\n            out += escapeHtml(node)\n          }\n        }\n      }\n    }\n\n    return out\n  }\n}\n\nexport function renderToString(view, state, actions) {\n  return renderer(view, state, actions)(Infinity)\n}\n"],"names":["isArray","Array","hasOwnProperty","Object","prototype","styleNameCache","Map","uppercasePattern","msPattern","escapeRegExp","voidElements","Set","escapeHtml","value","str","match","exec","index","lastIndex","out","escape","length","charCodeAt","substring","concatClassNames","delimiter","i","name","call","hyphenateStyleName","styleName","get","set","replace","toLowerCase","stringifyStyles","style","renderFragment","props","children","stack","footer","prop","has","innerHTML","push","childIndex","resolveNode","node","state","actions","renderer","view","end","bytes","frame","pop","type","nodeName","attributes","renderToString","Infinity"],"mappings":"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"}